/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn more about Gradle by exploring our samples at https://docs.gradle.org/7.4.2/samples
 */

task packAll() {
    description 'Creates the JRE\'s for all available platforms'
    group 'pack'
    dependsOn 'packWin'
    dependsOn 'packLinux'
    dependsOn 'packMac'
}

task winDel(type: Delete) {
    dependsOn(':src:compilerModule:build')
    delete 'build/jre/windows'
}

task winJlink(type:Exec) {
    dependsOn winDel

    commandLine "jlink", '--module-path', "src/jdk/17.0.2/windows/jmods${File.pathSeparatorChar}src/processing/build/modules/${File.pathSeparatorChar}src/compilerModule/build/libs/",
            '--add-modules', "core,compilerModule", '--output', "build/jre/windows", '--strip-debug',
            '--compress', '2', '--no-header-files', '--no-man-pages'

}

task packWin(type: Zip) {
    description 'Creates the JRE\'s for windows'
    group 'pack'

    dependsOn winJlink
    archiveBaseName = rootProject.getName()
    archiveAppendix = "windows-x64"
    destinationDirectory = layout.buildDirectory.dir('dist')

    from layout.buildDirectory.dir("jre/windows")
}

task linuxDel(type: Delete) {
    delete 'build/jre/Linux'
}

task linuxJlink(type:Exec) {
    dependsOn linuxDel

    commandLine "jlink", '--module-path', "src/jdk/linux/jmods${File.pathSeparatorChar}src/processing/build/modules/${File.pathSeparatorChar}src/compilerModule/build/libs/",
            '--add-modules', "core,compilerModule", '--output', "build/jre/linux", '--strip-debug',
            '--compress', '2', '--no-header-files', '--no-man-pages'
    
}

task packLinux(type: Tar) {
    description 'Creates the JRE\'s for linux'
    group 'pack'

    dependsOn linuxJlink
    archiveBaseName = rootProject.getName()
    archiveAppendix = "linux-x64"
    archiveExtension = "tar.gz"
    destinationDirectory = layout.buildDirectory.dir('dist')

    from layout.buildDirectory.dir("jre/linux")
}

task macDel(type: Delete) {
    delete 'build/jre/mac'
}

task macJlink(type:Exec) {
    dependsOn macDel

    commandLine "jlink", '--module-path', "src/jdk/mac/jmods${File.pathSeparatorChar}src/processing/build/modules/${File.pathSeparatorChar}src/compilerModule/build/libs/",
            '--add-modules', "core,compilerModule", '--output', "build/jre/mac", '--strip-debug',
            '--compress', '2', '--no-header-files', '--no-man-pages'
}

task packMac(type: Tar) {
    description 'Creates the JRE\'s for mac'
    group 'pack'

    dependsOn macJlink
    archiveBaseName = rootProject.getName()
    archiveAppendix = "mac-x64"
    archiveExtension = "tar.gz"
    destinationDirectory = layout.buildDirectory.dir('dist')

    from layout.buildDirectory.dir("jre/mac")
}
